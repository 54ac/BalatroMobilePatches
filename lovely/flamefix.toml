# Fixes the flame shadet
[manifest]
version = "1.0.0"
priority = 0

[[patches]]
[patches.pattern]
target = "game.lua"
pattern = 'self.SHADERS[shader_name] = love.graphics.newShader("resources/shaders/"..filename)'
position = "before"
payload = '''
if shader_name ==  "flame" then
	local code =
	love.filesystem.read("resources/shaders/"..filename)
	:gsub("#endif", "#endif\n#ifdef GL_ES\n\tprecision MY_HIGHP_OR_MEDIUMP float;\n#endif", 1)
	:gsub("vec4 effect%( vec4 colour, Image texture, vec2 texture_coords, vec2 screen_coords %)", "mediump vec4 effect%( mediump vec4 colour, Image texture, mediump vec2 texture_coords, mediump vec2 screen_coords %)", 1)
	print(code)
	G.SHADERS[shader_name] =  love.graphics.newShader(code)
else
'''
match_indent = true
times = 1

[[patches]]
[patches.pattern]
target = "game.lua"
pattern = 'self.SHADERS[shader_name] = love.graphics.newShader("resources/shaders/"..filename)'
position = "after"
payload = '''
end
'''
match_indent = true
times = 1
